# ESP32 433MHz RF 收发测试项目

基于ESP32-S3的433MHz射频收发系统，支持信号接收、复刻和发送功能。

## 项目简介

本项目实现了一个完整的433MHz射频信号收发系统，支持：
- 433MHz信号接收和解析
- 信号复刻（捕获并重发）
- 闪存持久化存储（关机不丢失）
- LED状态指示
- Boot按键控制（短按发送，长按清空）

## 硬件要求

- **ESP32-S3-DevKitC-1** 开发板
- **433MHz发射模块** (如MX-FS-03V)
  - DATA引脚 → GPIO14
  - VCC → 5V/3.3V
  - GND → GND
- **433MHz接收模块** (如Ling-R1A)
  - DATA引脚 → GPIO18 (UART RX)
  - VCC → 5V/3.3V
  - GND → GND
- **LED指示灯** (可选)
  - 正极 → GPIO21
  - 负极 → GND
- **Boot按键** (板载)
  - 用于控制复刻功能

## 功能特性

### 核心功能
- ✅ **信号接收**：自动接收并解析433MHz信号
- ✅ **信号复刻**：捕获遥控器信号并重发
- ✅ **闪存存储**：信号保存到闪存，关机后仍可恢复
- ✅ **复刻缓冲区**：自动保存最近接收的10个信号
- ✅ **自动捕获模式**：启动时自动进入捕获模式

### 用户交互
- ✅ **LED状态指示**（GPIO21，反向逻辑）
  - 熄灭（HIGH）：没有复刻信号
  - 快闪：复刻模式，等待接收信号
  - 常亮（LOW）：完成复刻，已捕获信号
- ✅ **Boot按键控制**
  - 短按（< 2秒）：发送复刻信号
  - 长按（≥ 2秒）：清空复刻信号

### 串口命令
- `capture` / `c` - 进入复刻模式，等待接收信号（LED快闪）
- `send` / `s` - 发送已捕获的信号（或短按boot按键）
- `replay` / `r` - 复刻最后接收的信号
- `list` / `l` - 列出复刻缓冲区中的所有信号
- `replay:N` - 复刻第N个信号（如: replay:1）
- `send:XXXXXXYY` - 手动发送指定信号（如: send:62E7E831）
- `test` - 发送测试信号
- `status` - 显示状态信息
- `reset` - 重置计数器
- `help` / `h` - 显示帮助信息

## 安装和使用

### 环境要求
- PlatformIO IDE 或 VS Code + PlatformIO插件
- ESP32开发环境

### 安装步骤

1. **克隆项目**
```bash
git clone https://github.com/zhoushoujianwork/433_test_arduino.git
cd 433_test_arduino
```

2. **安装依赖**
项目会自动从GitHub下载ESP433RF库，无需手动安装。

3. **编译和上传**
```bash
pio run -t upload
```

4. **监控串口**
```bash
pio device monitor
```

### 库依赖

项目使用以下库（在`platformio.ini`中自动配置）：
- `sui77/rc-switch@^2.6.4` - RCSwitch库，用于可靠的信号发送
- `https://github.com/zhoushoujianwork/ESP433RF.git` - ESP433RF库，433MHz收发核心库

## 使用说明

### 基本工作流程

1. **启动系统**
   - 系统启动后会自动从闪存加载保存的信号
   - 如果没有信号，自动进入复刻模式（LED快闪）

2. **捕获信号**
   - 使用 `capture` 命令进入捕获模式（或系统自动进入）
   - 按下遥控器按键
   - 信号捕获后，LED常亮，信号自动保存到闪存

3. **发送信号**
   - 短按boot按键发送复刻信号
   - 或使用 `send` 命令发送

4. **清空信号**
   - 长按boot按键2秒清空信号（内存+闪存）
   - 清空后自动进入复刻模式

### LED状态说明

| LED状态 | 含义 | 说明 |
|---------|------|------|
| 熄灭（HIGH） | 没有复刻信号 | 系统自动进入复刻模式 |
| 快闪 | 复刻模式 | 等待接收信号，每200ms切换一次 |
| 常亮（LOW） | 完成复刻 | 已捕获信号，可以发送 |

### 按键操作

| 操作 | 功能 | LED状态变化 |
|------|------|------------|
| 短按boot按键 | 发送复刻信号 | 保持当前状态 |
| 长按boot按键2秒 | 清空复刻信号 | 熄灭 → 快闪 |

## 编码格式说明

### 433MHz编码协议
- 协议：EV1527/PT2262
- 编码长度：24位
- 显示格式：
  - 6位显示：只显示地址码（如 `62E7E8`）
  - 8位显示：地址码（6位）+ 按键值（2位），如 `62E7E831`
  - 实际发送时只使用前24位（地址码）

### 信号格式
- **地址码**：6位十六进制（24位二进制）
- **按键值**：2位十六进制（8位二进制）
- **完整信号**：8位十六进制（如 `62E7E831`）

## 项目结构

```
433_test_arduino/
├── src/
│   └── main.cpp          # 主程序
├── platformio.ini        # PlatformIO配置文件
├── docs/                  # 文档目录
│   ├── IMG_5546.JPG      # 硬件图片
│   ├── Ling-T3Max.pdf    # 接收模块规格书
│   └── 灵-R1A接收模块规格书_V2.0.pdf
└── readme.md             # 本文件
```

## ESP433RF库功能

本项目使用的ESP433RF库提供以下功能：

### 核心功能
- 433MHz信号接收和发送
- 支持多种接收模块（Ling-R1A等）
- RCSwitch库集成，可靠的信号发送

### 高级功能
- **复刻缓冲区**：自动保存最近接收的信号
- **捕获模式**：自动捕获并保存信号
- **闪存持久化**：ESP32上支持信号持久化存储

详细API文档请参考：[ESP433RF库](https://github.com/zhoushoujianwork/ESP433RF)

## 技术细节

### 硬件连接

```
ESP32-S3-DevKitC-1
├── GPIO14 → 发射模块DATA
├── GPIO18 → 接收模块DATA (UART RX)
├── GPIO21 → LED指示灯（反向逻辑）
└── GPIO0  → Boot按键（板载）
```

### 配置参数

- **协议**：Protocol 1 (EV1527/PT2262)
- **脉冲长度**：320μs
- **重复次数**：5次
- **串口波特率**：9600

## 常见问题

### Q: 为什么地址码显示8位但很多信号助手显示6位？
A: 433MHz编码协议（EV1527/PT2262）只支持24位数据，24位=6位十六进制。8位显示包含了地址码（6位）+按键值（2位），但实际发送时只使用前24位（地址码）。

### Q: 信号保存后关机丢失？
A: 确保ESP433RF库的闪存功能已启用。系统会在捕获信号时自动保存到闪存。

### Q: LED不亮或状态不对？
A: 本项目使用反向逻辑（HIGH熄灭，LOW常亮）。检查LED连接是否正确。

## 开发说明

### 修改配置
- 引脚定义：在`src/main.cpp`中修改`TX_PIN`、`RX_PIN`、`LED_PIN`等
- 库参数：在`setup()`函数中修改协议、脉冲长度等

### 扩展功能
- 可以添加更多串口命令
- 可以添加WiFi/蓝牙控制
- 可以添加多信号管理

## 许可证

MIT License

## 作者

Zhoushoujian

## 相关链接

- [ESP433RF库](https://github.com/zhoushoujianwork/ESP433RF)
- [RCSwitch库](https://github.com/sui77/rc-switch)

## 更新日志

### v1.0.0
- 初始版本
- 实现433MHz信号收发
- 实现信号复刻功能
- 实现LED状态指示
- 实现Boot按键控制
- 实现闪存持久化存储
- 集成ESP433RF库
